{{ define "main" }}
  {{- $recipes := slice -}}

  {{- range sort (readDir "static/recipes") "Name" -}}
    {{- if and (not .IsDir) (strings.HasSuffix .Name ".md") (not (strings.HasPrefix .Name "_")) -}}
      {{- $anchor := strings.TrimSuffix ".md" .Name -}}
      {{- $fallbackTitle := replace $anchor "-" " " -}}

      {{- $path := printf "static/recipes/%s" .Name -}}
      {{- $raw := readFile $path -}}
      {{- $title := $fallbackTitle -}}
      {{- $m := findRESubmatch `(?m)^#\s+(.+?)\s*$` $raw 1 -}}
      {{- if gt (len $m) 0 -}}
        {{- $title = strings.TrimSpace (index (index $m 0) 1) -}}
      {{- end -}}

      {{- $recipes = $recipes | append (dict "anchor" $anchor "title" $title) -}}
    {{- end -}}
  {{- end -}}

  {{- $sorted := sort $recipes "title" -}}
  {{- $letters := slice -}}
  {{- $prevLetter := "" -}}
  {{- range $sorted -}}
    {{- $letter := upper (substr .title 0 1) -}}
    {{- if ne $letter $prevLetter -}}
      {{- $letters = $letters | append $letter -}}
      {{- $prevLetter = $letter -}}
    {{- end -}}
  {{- end -}}

  <div id="wrapper" class="index">
    <section id="toc">
      <h1 id="mainTitle">{{ .Site.Title }}</h1>
      <p id="navigation">
        {{- range $letters -}}
          <a href="#{{ . }}">{{ . }} </a>
        {{- end -}}
      </p>

      <ul>
        {{- $prevLetter = "" -}}
        {{- range $sorted -}}
          {{- $letter := upper (substr .title 0 1) -}}
          {{- if ne $letter $prevLetter -}}
            <li id="{{ $letter }}">
          {{- else -}}
            <li>
          {{- end -}}
            <a href="{{ "recipe/" | relURL }}#{{ .anchor }}">{{ .title }}</a>
          </li>
          {{- $prevLetter = $letter -}}
        {{- end -}}
      </ul>
    </section>

    <!-- <section id="footer">
         <ul>
         </ul>
         </section> -->
  </div>
{{ end }}
